---
title: 制作一个网站，用户可以选择服务端脚本并执行
date: 2024/11/9 17:30:14
categories:
  - - Production
abbrlink: "373370e4"
---

## PM2 运行Bash脚本

pm2 list      # 进程列表
pm2 monit     # 实时监控
pm2 logs      # 日志输出

pm2 start app.js  
pm2 start app.sh  

pm2 start app.js --name my-app

pm2 start run-script-node.js --name sak-rezedge-com

pm2 restart sak-rezedge-com
pm2 stop my-app
pm2 delete my-app


## 脚本示例

**updateblog 脚本**

```javascript
// run-script-node.js
const express = require('express');
const { spawn } = require('child_process');

const app = express();
const PORT = 3764;

app.use(express.json());

app.get('/updateblog', (req, res) => {
    const scriptPath = "/www/updateBlog.sh";
    const child = spawn('bash', [scriptPath]);

    // 设置响应头，让浏览器逐步接收数据
    res.setHeader('Content-Type', 'text/plain; charset=utf-8');

    // 脚本的标准输出实时写入响应
    child.stdout.on('data', (data) => {
        res.write(data.toString());
    });

    // 脚本的错误输出也写到响应里
    child.stderr.on('data', (data) => {
        res.write(`ERR: ${data.toString()}`);
    });

    // 脚本结束时关闭响应
    child.on('close', (code) => {
        res.end(`\nScript finished with code ${code}\n`);
    });
});

app.listen(PORT, () => {
    console.log(`Server is running on port ${PORT}`);
});


```

存储库更新脚本：
```shell
cd /opt/1panel/www/sites/blog.rezedge.com/source/_posts

BRANCH=master

LOCAL=$(git log $BRANCH -n 1 --pretty=format:"%H")
REMOTE=$(git log remotes/origin/$BRANCH -n 1 --pretty=format:"%H")

if [ $LOCAL = $REMOTE ]; then
    echo "Up-to-date"
else
    echo "Need update"
    git fetch --all
    git reset --hard origin/master 
    git pull
fi
echo "Start generate"
cd /opt/1panel/www/sites/blog.rezedge.com/
pnpm hexo generate
rm -r ./index/
mv ./public/ ./index/
```